define("#mix/core/0.3.0/mvc/controller",["mix/core/0.3.0/base/reset","mix/core/0.3.0/base/class","mix/core/0.3.0/base/message","history","mix/core/0.3.0/url/router"],function(a,b,c){a("mix/core/0.3.0/base/reset");var d=a("mix/core/0.3.0/base/class"),e=a("mix/core/0.3.0/base/message"),f=a("history").singleton,g=a("mix/core/0.3.0/url/router").singleton,h=void 0,i=e.spliterReg,j=e.atReg,k=d.create({Implements:e,initialize:function(a,b){var c=this,d=c._options=Object.extend({routes:{},historyEvents:{"navigator:route":c._routeHandler},controllerEvents:{destroy:c.destroy}},b||{});e.prototype.initialize.call(c,"controller."+a),c._appname=a,c._routename=h,c._views={},c.on("install",function(){c._bindRoutes(d.routes),c._bindHistoryEvents(d.historyEvents),c._bindControllerEvents(d.controllerEvents),f.match()})},_bindRoutes:function(a){var b=this,c=b._appname;Object.each(a,function(a,b){g.addRoute(c+"/"+b,a)})},_unbindRoutes:function(a){var b=this,c=b._appname;Object.each(a,function(a,b){g.removeRoute(c+"/"+b)})},_bindHistoryEvents:function(a){var b=this;Object.each(a,function(a,c){f.on(c,a,b)})},_unbindHistoryEvents:function(a){Object.each(a,function(a,b){f.off(b,a)})},_bindControllerEvents:function(a){var b=this;Object.each(a,function(a,c){b.on(c,a,b)})},_routeHandler:function(a,b){var c=this,d=g.getState(),e=d.params.slice(0);c._appname===a&&(c._routename=b,e.unshift("route:"+b),c.trigger.apply(c,e))},getName:function(){var a=this;return a._appname},getAppName:function(){var a=this;return a._appname},getRouteName:function(){var a=this;return a._routename},getViewport:function(){var a=this,b=a._appname;return"viewport-"+b},addView:function(a,b){var e,f,c=this;return a.superclass&&a.superclass instanceof d&&(e=a,a=new e(h,c,b)),f=a.getName(),c._views[f]=a,f},getView:function(a){var b=this;return b._views[a]},getParameter:function(a){var c=g.getState(),d=c.params,e=c.paramKeys,f=Object.isTypeof(a,"number")?a:e[a];return f!=h?d[f]:void 0},getArgument:function(a){var c=g.getState(),d=c.args;return d[a]},trigger:function(a){var b=this,c=Array.make(arguments),d=(j.exec(a)||[])[1];d&&(c[0]=a.replace(i," @"+d+":")),e.prototype.trigger.apply(b,c)},destroy:function(){var a=this,b=a._options,c=b.routes,d=b.historyEvents;a._unbindRoutes(c),a._unbindHistoryEvents(d)}});c.exports=k});