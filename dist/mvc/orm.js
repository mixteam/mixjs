define("#mix/core/0.3.0/mvc/orm",["mix/core/0.3.0/base/reset","mix/core/0.3.0/base/class","model"],function(a,b,c){a("mix/core/0.3.0/base/reset");var e=(a("mix/core/0.3.0/base/class"),a("model"));ORM=e.extend({test:function(){console.log(this.init())},init:function(){this.records={},this.attributes=[]},find:function(a){var b=this.records[a];if(!b)throw"Unknown record";return b.dup()},exists:function(a){try{return this.find(a)}catch(b){return!1}},populate:function(a){this.records={};for(var b=0,c=a.length;c>b;b++){var d=this.inst(a[b]);d.newRecord=!1,this.records[d.id]=d}},select:function(a){var b=[];for(var c in this.records)a(this.records[c])&&b.push(this.records[c]);return this.dupArray(b)},findByAttribute:function(a,b){for(var c in this.records)if(this.records[c][a]==b)return this.records[c].dup()},findAllByAttribute:function(a,b){return this.select(function(c){return c[a]==b})},each:function(a){for(var b in this.records)a(this.records[b])},all:function(){return this.dupArray(this.recordsValues())},first:function(){var a=this.recordsValues()[0];return a&&a.dup()},last:function(){var a=this.recordsValues(),b=a[a.length-1];return b&&b.dup()},count:function(){return this.recordsValues().length},deleteAll:function(){for(var a in this.records)delete this.records[a]},destroyAll:function(){for(var a in this.records)this.records[a].destroy()},update:function(a,b){this.find(a).updateAttributes(b)},create:function(a){var b=this.inst(a);return b.save(),b},destroy:function(a){this.find(a).destroy()},recordsValues:function(){var a=[];for(var b in this.records)a.push(this.records[b]);return a},dupArray:function(a){return a.map(function(a){return a.dup()})}}),ORM.singleton=new ORM,ORM.Model=e,c.exports=ORM});