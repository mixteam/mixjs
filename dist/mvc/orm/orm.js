define("mix/core/0.3.0/mvc/orm/orm",["mix/core/0.3.0/base/reset/reset","mix/core/0.3.0/base/class/class","mix/core/0.3.0/mvc/model/model","mix/core/0.3.0/base/util/util"],function(e,t,n){e("mix/core/0.3.0/base/reset/reset");var r=e("mix/core/0.3.0/base/class/class"),i=e("mix/core/0.3.0/mvc/model/model");ORM=i.extend({test:function(){console.log(this.init())},init:function(){this.records={},this.attributes=[]},find:function(e){var t=this.records[e];if(!t)throw"Unknown record";return t.dup()},exists:function(e){try{return this.find(e)}catch(t){return!1}},populate:function(e){this.records={};for(var t=0,n=e.length;t<n;t++){var r=this.inst(e[t]);r.newRecord=!1,this.records[r.id]=r}},select:function(e){var t=[];for(var n in this.records)e(this.records[n])&&t.push(this.records[n]);return this.dupArray(t)},findByAttribute:function(e,t){for(var n in this.records)if(this.records[n][e]==t)return this.records[n].dup()},findAllByAttribute:function(e,t){return this.select(function(n){return n[e]==t})},each:function(e){for(var t in this.records)e(this.records[t])},all:function(){return this.dupArray(this.recordsValues())},first:function(){var e=this.recordsValues()[0];return e&&e.dup()},last:function(){var e=this.recordsValues(),t=e[e.length-1];return t&&t.dup()},count:function(){return this.recordsValues().length},deleteAll:function(){for(var e in this.records)delete this.records[e]},destroyAll:function(){for(var e in this.records)this.records[e].destroy()},update:function(e,t){this.find(e).updateAttributes(t)},create:function(e){var t=this.inst(e);return t.save(),t},destroy:function(e){this.find(e).destroy()},recordsValues:function(){var e=[];for(var t in this.records)e.push(this.records[t]);return e},dupArray:function(e){return e.map(function(e){return e.dup()})}}),ORM.singleton=new ORM,ORM.Model=i,n.exports=ORM});