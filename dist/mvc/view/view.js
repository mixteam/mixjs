define("#mix/core/0.3.0/mvc/view/view",["mix/core/0.3.0/base/reset","mix/core/0.3.0/base/class","mix/core/0.3.0/base/message","mix/core/0.3.0/ui/template","mix/core/0.3.0/ui/component","mix/core/0.3.0/dom/selector","mix/core/0.3.0/dom/event","mix/core/0.3.0/dom/ajax"],function(a,b,c){a("mix/core/0.3.0/base/reset");var d=a("mix/core/0.3.0/base/class"),e=a("mix/core/0.3.0/base/message"),f=a("mix/core/0.3.0/ui/template"),g=a("mix/core/0.3.0/ui/component"),h=a("mix/core/0.3.0/dom/selector"),i=e.atReg;a("mix/core/0.3.0/dom/event"),a("mix/core/0.3.0/dom/ajax");var j=window;doc=j.document,head=doc.getElementsByTagName("head")[0],undef=void 0,COMP_OPEN_REGEXP=/\<h5\:(\w\w*?)\s([^>]*?)\>/g,COMP_CLOSE_REGEXP=/\<\/h5\:(\w\w*?)\s*\>/g,COMP_SELF_CLOSE_REGEXP=/<component\s([^>]*?)\/>/g;var k=d.create({initialize:function(a,b,c){var d,e,f,g,h,i=this;d=Object.extend({loadTmpl:!1,loadStyle:!1},i.CONFIGS||{}),e=Object.extend({install:"install",render:"render",parse:"parse",update:"update",suspend:"suspend",active:"active",destroy:"destroy"},i.EVENTS||{}),attrs=Object.extend({},i.ATTRS||{}),f=Object.extend({},i.ROUTES||{}),g=Object.extend({},i.ATTACH||{}),h=Object.extend({},i.DATA||{}),compdata=Object.extend({},i.COMPDATA||{}),helper=Object.extend({},i.TMPL_HELPER||{}),partial=Object.extend({},i.TMPL_PARTIAL||{}),i._name=a||d.name,i._controller=b||d.controller,i._viewport=c||d.viewport,i._src={tmpl:d.tmpl,style:d.style,loadTmpl:d.loadTmpl,loadStyle:d.loadStyle},i._attrs=attrs,i._attach=g,i._data=h,i._dataChanged=undef,i._compdata=compdata,i._components={},i._templates=[],i._tmplHelper=helper,i._tmplPartial=partial,i._isInstalling=!1,i._isCompiled=!1,i._isReady=!1,i._isActive=!1,i._bindEvents(e),i._bindRoutes(f),delete i.CONFIGS,delete i.EVENTS,delete i.ATTRS,delete i.ROUTES,delete i.ATTACH,delete i.DATA,delete i.COMPDATA,delete i.TMPL_HELPERS,delete i.TMPL_PARTIAL},_bindEvents:function(a){var b=this,c=0;Object.each(a,function(a,d){Object.isTypeof(a,"Array")||(a=[a]),Object.each(a,function(a){Object.isTypeof(a,"string")&&(a=b[a]),c++,b.on(d,a)})}),b.log("binded "+c+" events")},_bindRoutes:function(a){var b=this,c=0;Object.each(a,function(a,d){Object.isTypeof(a,"Array")||(a=[a]),Object.each(a,function(a){c++,b._route(d,a)})}),b.log("binded "+c+" routes")},_route:function(a,b){var c=this;Object.isTypeof(b,"string")&&(b=c[b]),b&&c.on("route:"+a,k.ready(b))},_bindAttach:function(){var a=this,b=a._attach,c=0;Object.each(b,function(b,d){Object.each(b,function(b,e){c++,a.attach(e,d,b)})}),a.log("binded "+c+" attachs")},_unbindAttach:function(){var a=this;a.disattach()},install:function(){var a=this,b=a._src,c=(a.getViewport(),!1);a._isInstalling||a._isReady||(a._isInstalling=!0,b.loadTmpl!==!1?(c=!0,a._loadTmpl(b.loadTmpl)):b.tmpl&&a._compileTmpl(),b.loadStyle!==!1?(c=!0,a._loadStyle(b.loadStyle)):b.style&&a._compileStyle(),c?a._checkCompiled():a._compiled())},_checkCompiled:function(){var a,b=this,c=b._src,d=b.getViewport();d.addClass("compiling"),a=setInterval(function(){var e=c.tmpl,g=c.style,h=b._isCompiled;!h&&e&&e instanceof f&&g&&g.nodeName&&"style"==g.nodeName.toLowerCase()&&(clearInterval(a),d.removeClass("compiling"),b._compiled())},100)},_loadTmpl:function(a){var b=this,c=b._src;h.get(a,function(a){c.tmpl=a,b._compileTmpl()})},_loadStyle:function(a){var b=this,c=b._src;h.get(a,function(a){c.style=a,b._compileStyle()})},_replaceComponentTag:function(a){return a.replace(COMP_OPEN_REGEXP,'<component cid="$1" $2>').replace(COMP_CLOSE_REGEXP,"</component>").replace(COMP_SELF_CLOSE_REGEXP,"<component $1></component>")},_compileTmpl:function(){var a,b=this,c=b._name,d=(b._components,b._templates),e=b._src,g=e.tmpl,h=b._tmplHelper,i=b._tmplPartial;Object.isTypeof(g,"string")&&(a=b._replaceComponentTag(g),g=new f("template-"+c),g.addHelper(h),g.addPartial(i),g.compile(a),e.tmpl=g),d.push(g)},_compileStyle:function(){var a,b=this,c=b._name,d=b._src,e=d.style;hasLess=!!j.less,Object.isTypeof(e,"string")&&(a=e,e=doc.createElement("style"),e.setAttribute("type",hasLess?"text/less":"text/css"),e.setAttribute("rel","stylesheet"),e.setAttribute("id","stylesheet-view-"+c),e.innerHTML=a),!e.parentNode&&head.appendChild(e),hasLess&&less.refresh("development"===less.env),d.style=e},_compiled:function(){var a=this;a._isInstalling=!1,a._isCompiled=!0,a._bindAttach(),a.render(),a.parse(),a.ready("ready")},getName:function(){var a=this;return a._name},getController:function(){var a=this;return a._controller},getViewport:function(){var a=this,b=a._viewport,c=a._controller;return h(b||"#"+c.getViewport())},getAttr:function(a){var b=this,c=b._attrs;return c[a]},setAttr:function(a,b){var c,d=this,e=d._attrs;return 1===arguments.length&&Object.isTypeof(c=a,"object")?(Object.each(c,function(a,b){d.setAttr(b,a)}),void 0):(e.hasOwnProperty(a)&&(e[a]=b),void 0)},_findDataPath:function(a,b){return Object.each(b,function(b){return a.hasOwnProperty(b)?(a=a[b],void 0):undef}),a},_getData:function(a,b){var c,d=this;return"string"==typeof b&&(b=b.split(".")),c=b.pop(),a=d._findDataPath(a,b),a?a[c]:void 0},_setData:function(a,b,c,d){var e,f,g=this;return!Object.isTypeof(f=b,"object")||f instanceof Array?(c!=undef&&("string"==typeof b&&(b=b.split(".")),e=b.pop(),a=g._findDataPath(a,b),a&&(a[e]=Object.clone(c,!0),d||(b.push(e),dataChanged=g._dataChanged||(g._dataChanged={}),dataChanged[b.join(".")]=a[e]))),void 0):(d=c,Object.each(f,function(a,b){g.setData(b,a,d)}),void 0)},getData:function(a){var b=this;return b._getData(b._data,a)},setData:function(a,b,c){var d=this;d._setData(d._data,a,b,c)},getCompData:function(a){var b=this;return b._getData(b._compdata,a)},setCompData:function(a,b){var c=this;return 1===arguments.length?c._setData(c._compdata,a,!0):c._setData(c._compdata,a,b,!0)},getComponent:function(a){var b=this,c=b._components;return c[a]},newComponent:function(a,b,c,d){var e,f=this,h=f._components;return Object.isTypeof(a,"string")&&(a=g.depos(a)),3===arguments.length&&(d=c,c=null),a&&(e=new a(b,c,d),h[b]=e),e},newTmpl:function(a,b,c){var d,e=this,g=e._templates,b=Object.extend(e._tmplHelper,b||{}),c=Object.extend(e._tmplPartial,c||{});return a?(a=e._replaceComponentTag(a),d=new f("template-runtime-"+Date.now()),d.addHelper(b),d.addPartial(c),d.compile(a),g.push(d),d):void 0},render:function(a){this.trigger("beforeRender");var b,c=this,a=a||c._data,d=c._src,e=d.tmpl;e.all(a),b=c.getViewport(),b.html(""),b.append(e.getNodeList()),c.log("renderd")},parse:function(a){this.trigger("beforeParse");var b=this,a=a||b._compdata,c=b._components,d=b.getViewport(),e=d.find("component");Object.each(e,function(d){var e,f,i=h(d),j=i.attr("cid"),k=i.attr("id"),l=i.attr("name"),m=i.attr("data-bind"),n=b._getData(a,m);e=g.depos(j),e&&(f=new e(k,l,n),f.render(),c[k]=f,i.replaceWith(f.getDom()))}),b.log("parsed")},update:function(a,b){this.trigger("beforeUpdate");var c=this,d=c._dataChanged,e=c._src,f=e.tmpl;a&&b&&(d={},d[a]=b),d&&Object.each(d,function(a,b){f.update(b,a)}),delete c._dataChanged,c.log("updated")},active:function(){this.trigger("beforeActive");var a,b=this,c=c||b._data,d=b._src;d.tmpl,a=b.getViewport(),""===a.html()&&(b._bindAttach(),b.render(),b.parse()),b.ready("actived")},suspend:function(){this.trigger("beforeSuspend");var a=this;a._isActive=!1,a.trigger("suspended")},ready:function(a){var b=this;b._isActive=!0,b._isReady=!0,b.trigger(a||"ready")},destroy:function(){this.trigger("beforeDestroy");var a=this,b=a._src,c=b.style,d=a._components,e=a._templates;a._unbindAttach(),c&&head.removeChild(c),e&&Object.each(e,function(a){a.destroy()}),d&&Object.each(d,function(a){a.destroy()}),delete a._compdata,delete a._data,delete a._attach,delete a._src,delete a._components,a.trigger("destroyed")},attach:function(a,b,c){var d,e=this,f=e.getViewport(),g=arguments.length;Object.isTypeof(c,"string")&&(c=e[c]),d=function(a){c.call(this,a,e)},c&&(3===g?f.on(a,b,d):2===g&&(c=b,f.on(a,d)))},disattach:function(a,b,c){var d=this,e=d.getViewport(),f=arguments.length;c&&(3===f?(Object.isTypeof(c,"string")&&(c=d[c]),e.off(a,b,c)):2===f?(Object.isTypeof(b,"string")&&(b=d[b]||b),e.off(a,b)):1===f?e.off(a):0===f&&e.off())},has:function(a,b){var c=this,d=c._name,e=c._controller;return e.has("@"+d+":"+a,b,c),c},once:function(a,b){var c=this,d=c._name,e=c._controller;return e.once("@"+d+":"+a,b,c),c},on:function(a,b){var c=this,d=c._name,e=c._controller;return e.on("@"+d+":"+a,b,c),c},off:function(a,b){var c=this,d=c._name,e=c._controller;return e.off("@"+d+":"+a,b,c),c},trigger:function(a){var b=this,c=b._name,d=b.getController(),e=Array.make(arguments);i.test(a)||(e[0]="@"+c+":"+e[0]),d.trigger.apply(d,e)},log:function(a){var b=this,c=b._name,d=b._controller;return d.log("@"+c+":"+a),b}});k.ready=function(a){return function(){var b=this,c=b._isReady,d=arguments;c?a.apply(b,d):b.once("ready",function(){a.apply(b,d)})}},c.exports=k});