define("#mix/core/0.3.0/ui/template",["mix/core/0.3.0/base/reset","mix/core/0.3.0/base/class","mix/libs/handlebars/1.0.5/handlebars"],function(a,b,c){a("mix/core/0.3.0/base/reset");var d=a("mix/core/0.3.0/base/class"),e=a("mix/libs/handlebars/1.0.5/handlebars"),g=window,h=g.document,i=d.create({initialize:function(a,b,c){var d=this;d._id=i.id(),d._name=a||"template"+d._id,d._type=b||"template",d._root=c||"root",d._helpers={},d._partials={},d._chunks={},d._html="",d._nodeList=[]},_init:function(){var a=this;a._helpers=Object.extend(a._helpers,e.helpers),a._partials=Object.extend(a._partials,e.partials),i.helpers(a),i.partials(a),i.chunks(a)},addHelper:function(a,b){var c=this;return 1===arguments.length?(Object.each(arguments[0],function(a,b){c.addHelper(b,a)}),void 0):(c._helpers[a]=b,void 0)},addPartial:function(a,b){var c=this;return 1===arguments.length?(Object.each(arguments[0],function(a,b){c.addPartial(b,a)}),void 0):(c._partials[a]=b,void 0)},addChunk:function(a,b){var c=this;c._chunks[a]=b},compile:function(a){var b=this;a&&(b._init(),b._template=i.compile(b,a))},getHtml:function(){var a=this;return a._html},getNodeList:function(){var a=this;return a._nodeList.slice(0)},_wrap:function(a){var i,j,b=this,c=b._name,d=b._id,e=c+"/"+d,f=b._type,g=h.createElement("div");g.innerHTML=a,i=g.firstElementChild,j=g.lastElementChild,i||(i=h.createElement("template"),g.firstChild?g.insertBefore(i,g.firstChild):g.appendChild(i)),j||(j=h.createElement("template"),g.appendChild(j)),i.setAttribute(f+"-begin",e),j.setAttribute(f+"-end",e),b._html=g.innerHTML,b._nodeList=[],Object.each(g.childNodes,function(a){b._nodeList.push(a)})},all:function(a){var g,b=this,c=b._root,d=b._helpers,a=(b._name,a||b._data);return b._data=a,c instanceof i&&(d=Object.extend({},c._helpers,d)),g=b._template(a,{helpers:d}),b._template2=e.compile(g),g=b._template2({},{partials:b._partials}),b._wrap(g),b._html},_replace:function(){var g,i,j,k,a=this,b=a._name,c=a._id,d=a._type,e=a._nodeList,f=h.createDocumentFragment();for(g=h.querySelector("*["+d+'-begin="'+b+"/"+c+'"]'),i=h.querySelector("*["+d+'-end="'+b+"/"+c+'"]'),k=g.parentNode||i.parentNode;g!==i;)j=g.nextElementSibling,k.removeChild(g),g=j;Object.each(e,function(a){f.appendChild(a)}),k.insertBefore(f,i),k.removeChild(i)},update:function(a,b){var e,f,g,i,j,c=this;return h.createElement("template"),e="string"==typeof a?a.split(/[.\/]/g):a,e.length?(g=e[0],f=c._chunks[g],f?(c._partials[g]=f.update(e.slice(1),b),c._html=c._template2({},{partials:c._partials})):(i=c._data,j=e.pop(),Object.each(e,function(a){i=i[a]}),i[j]=b,c.all(),c._replace())):(i=c._data,Object.keys(i).length!==Object.keys(b).length&&(b=Object.extend({},i,b)),c.all(b),c._replace()),c._html},destroy:function(){var a=this,b=a._chunks;Object.each(b,function(a){a.destroy()}),delete a._template,delete a._template2,delete a._data,delete a._chunks}}),j=/(\{\{#chunk\s+[^}\s]+\s*[^}]*\}\})|(\{\{\/chunk\}\})/g,k=/\{\{#chunk\s+([^}\s]+)\s*\}\}/,l=/\{\{\/chunk\}\}/,m=1;i.id=function(){return m++},i.helpers=function(a){a.addHelper("chunk",function(b){var c;return c=a._chunks[b],a._partials[b]=c.all(this),new e.SafeString("{{> "+b+"}}")})},i.partials=function(){},i.chunks=function(){},i.compile=function(a,b){var c,d=[],f=[];return c=b.match(j),c&&c.forEach(function(c){var g,h,j,m,n,o,p,q,r,s,t,u;h=c.match(l),h?(g=d.pop(),p=f.pop(),q=f.length?f[f.length-1]:a,j=g[0],m=h[0],t=g[1],n=b.indexOf(j),o=b.indexOf(m),r=b.substring(0,n),u=b.substring(n+j.length,o),s=b.substring(o+m.length),b=r+"{{#with "+t+'}}{{chunk "'+t+'"}}{{/with}}'+s,p._name=t,p._root=q,p._type="chunk",p._template=e.compile(u),q.addChunk(t,p)):(g=c.match(k),d.push(g),q=new i,q._init(),f.push(q))}),e.compile(b)},c.exports=i});